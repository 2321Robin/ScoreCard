# 打牌积分表单

线下打牌记分网页，移动端友好，含自动平衡、撤销重做、CSV 导入导出、目标局数自动导出等功能，数据默认保存在浏览器。

## 功能概览
- 玩家管理：默认 4 人（玩家 A/B/C/D），2-8 人可增删改，自动同步表格列；支持重命名。
- 录入与编辑：在“新增一局”填写分值（可输入或下拉选择），点“自动平衡”用空白或最后一人补齐；已记录行需点“编辑”后保存/取消，整局可删除。
- 分值范围：默认 -10~-1，可自定义上下限，刷新下拉列表。
- 平衡校验：每局总和必须为 0；失衡行红底提示，可一键平衡。
- 撤销/重做：最多 50 步；清空前需确认。
- 汇总与折线：实时总分卡片；支持展开/收起“分数变化折线图”查看累计走势。
- CSV 导入导出：导出含时间戳、玩家列、每局分值、逐局累计、总分行，UTF-8 BOM 兼容 Excel，文件名 `scores-YYYYMMDD-HHMM.csv`；可导入此前导出的 CSV 覆盖当前数据。
- 目标局数：可预设总局数，达标后自动导出一次并询问是否继续，可重设或清空目标。
- 持久化与无障碍：localStorage 自动保存；提供 skip link、aria 标签、键盘可操作；浅色柔和主题（surface #f7f6f1 / panel #ffffff / accent #7fb37a / text #2f3128 / muted #6f7664 / danger #e25b5b）。

## 使用说明
1) 新增一局：在“新增一局”为每位玩家输入或下拉选择分值，必要时点“自动平衡”，再点“添加本局”。
2) 编辑/删除：在对局表中点“编辑”进入可改状态，完成后“保存”或“取消”；可删除整局。
3) 撤销/重做：顶部按钮回溯或恢复最近 50 步操作；“清空”需确认。
4) 导出/导入：点“导出 CSV”下载，点“导入 CSV”选择此前导出的文件即可恢复。
5) 目标局数：顶部输入目标后点“设定”；达标会自动导出并提示是否继续，继续可输入新目标。
6) 自定义分值范围：在新增区域输入上下限并点“更新范围”。

## 手机访问（无备案）
- Cloudflare Tunnel：（可能不稳定）
  1) 安装：`winget install cloudflare.cloudflared`
  2) 启动项目：
  ```bash
  npm run dev -- --host 127.0.0.1 --port 5173
  ```
  3) 另开终端：
  ```bash
  cloudflared tunnel --url http://127.0.0.1:5173
  ```
  4) 使用输出的 `https://xxxx.trycloudflare.com` 在手机访问（重启会换链接）
  5) 若遇 1033/无法访问，重启 cloudflared；如网络对 QUIC 不友好，追加 `--protocol h2mux`

## 开发与运行
```bash
npm install
npm run dev     # 开发
npm run build   # 生产构建
npm run preview # 本地预览构建
npm run test:run
```

## 技术栈
- Vite + React + Tailwind CSS
- 测试：Vitest + Testing Library
- 状态：组件内 useState + useMemo；localStorage 持久化

## 待办
- 已完成：
  - 扩展为多会话数据模型，支持会话切换/新建/删除/重命名，旧版数据自动生成默认会话，撤销/重做按会话独立历史。
  - 录入/编辑/撤销/目标局数/导入导出均作用于当前会话，切换时重置编辑与输入状态。
- 未完成：
  - 跨会话总览表格：展示各会话总分、局数、时间，支持排序；提供“当前会话/全部会话”导出。
  - 跨会话折线图：按会话顺序展示玩家累计总分，可切换单会话累计与跨会话累计视图。
  - CSV 导入/导出 v2：含会话元数据；向后兼容 v1（单会话导入自动包裹为一个会话）。
  - 测试补充：导入解析 v1/v2、会话切换与聚合计算、跨会话表格与折线图渲染回归。


