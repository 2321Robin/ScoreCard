# 打牌积分表单

轻量的线下打牌记分网页，移动端友好，支持撤销/重做、自动平衡、导出 CSV，并自动本地保存数据。

## 当前特性
- 玩家管理：默认 4 人（玩家 A/B/C/D），2-8 人可增删改，自动同步各局列。
- 录入方式：先在“新增一局”模块填写分值（文本输入可直接键入，旁边下拉可选），再添加到对局记录；已保存的行需点“编辑”进入修改，再“保存/取消”。
- 分值范围：默认 -10~-1，可自定义上下限，自动刷新下拉选项。
- 平衡校验：每局分值和必须为 0；提供自动平衡（用最后一位补齐差值）；失衡行醒目标记。
- 撤销/重做：最多 50 步；清空需二次确认。
- 总分汇总：实时汇总各玩家总分并标记领先。
- 导出 CSV：含时间戳、玩家列、每局分值、逐局累计总分列、总分行；UTF-8 BOM 兼容 Excel；文件名 `scores-YYYYMMDD-HHMM.csv`。
- 导入 CSV：可从此前导出的 CSV 读取玩家与对局数据，替换当前数据。
- 目标局数：可预设总局数，达到后自动导出 CSV 并提示是否继续，可重新设定新目标。
- 持久化：localStorage 自动保存玩家与对局数据，刷新不丢失。
- 主题：浅色柔和配色（surface #f7f6f1 / panel #ffffff / accent #7fb37a / text #2f3128 / muted #6f7664 / danger #e25b5b）。
- 无障碍：aria-label、aria-invalid、skip link、键盘可操作；焦点态可见。

## 使用说明
1) 新增一局：在“新增一局”区域为每个玩家输入或下拉选择分值，可点“自动平衡”补齐，确认后点“添加本局”。
2) 编辑/删除：在记录表中点击“编辑”进入可改状态，改完点“保存”或“取消”；可删除整局。
3) 撤销/重做：顶部按钮可回溯/恢复最近 50 步操作。
4) 导出：点击“导出 CSV”，下载含逐局累计的表格文件。
4.1) 导入：点击“导入 CSV”，选择此前导出的文件即可恢复数据。
4.2) 设定局数：在顶部输入“目标局数”并点击设定；对局数达到后会自动导出并询问是否继续，继续可输入新目标。
5) 自定义分值范围：在新增区域设置上下限并“更新范围”，下拉选项随之刷新。

## 手机访问（无备案）
- Cloudflare Tunnel（免防火墙入站、免备案）：
	1) 安装：`winget install cloudflare.cloudflared`。
	2) 本地启动：
	```
	npm run dev -- --host 127.0.0.1 --port 5173
	```
	3) 另开终端：
	```
	cloudflared tunnel --url http://127.0.0.1:5173
	```
	4) 用输出的 `https://xxxx.trycloudflare.com` 在手机打开（每次重启会换新链接）。
	5) 如遇 1033/无法访问，重启 cloudflared；如网络对 QUIC 不友好，用 `--protocol h2mux`。

## 开发与运行
```bash
npm install
npm run dev     # 开发
npm run build   # 生产构建
npm run preview # 本地预览构建
npm run test:run
```

## 技术栈
- Vite + React + Tailwind CSS
- 测试：Vitest + Testing Library
- 状态：组件内 useState + useMemo；localStorage 持久化

## 已知不做/待办
- CSV 导入暂未实现（仅导出）。
- 复制上一行入口已移除，若需要可后续按需恢复。
