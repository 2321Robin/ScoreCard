# 打牌积分表单网页

## 目标
- 单页表单，记录每一局每位玩家的输赢；每局分值和必须为 0（输赢平衡）；支持快速新增一局、实时汇总总分，并可导出表格。
- 面向线下打牌小群体，移动端优先，操作极简。

## 阶段 1：需求与范围（已完成）
- 玩家：默认 4 人（玩家 A/B/C/D），最多 8 人；可重命名、增删，至少保留 2 人。
- 分值与校验：单元格仅整数；每局总和必须为 0，不平衡时整行标红并禁止保存/新增；提供“自动平衡”按钮自动用最后一名玩家补齐差值。
- 快速输入：为每个单元格提供 -10 至 10 的按钮；额外“+10”“-10”叠加按钮用于更大范围；移动端可长按连续加减（节流防抖）。
- 交互优先级：移动端优先，表头横向滚动，右下角悬浮“新增一局”按钮，触控命中区域 40px+。
- 数据操作：撤销/重做（至少 50 步）；清空需二次确认。
- 导出：CSV，文件名 `scores-YYYYMMDD-HHMM.csv`，内容含玩家列、局号、分值、总分、时间戳；导入 CSV 后补。
- 持久化：localStorage 自动保存 players 与 rounds，刷新不丢数据。
- 无障碍：键盘可导航，焦点态可见，aria-label 覆盖按钮，配色对比度达标。

## 阶段 2：设计方案（已完成）
- 信息架构与布局：顶部操作区，表头横向滚动，数据区行操作（自动平衡/复制上一行/删除），汇总条（移动端底部/桌面右侧），右下角悬浮“新增一局”。
- 组件规范：数字输入（整数、微调箭头、错误态红框+提示），-10~10 快速按钮组附加 ±10 叠加；长按连续加减；行级警示条与顶部 toast；导出按钮提示文件名。
- 移动端与响应式：表头与数据区可横向滚动，固定首列局号；<600px 单列，600-1024px 顶部按钮折行，>1024px 表格+右侧汇总并排；浮动按钮触控区域 40px+。
- 无障碍与键盘：Tab 顺序明确，aria-label 覆盖按钮，焦点态可见，对比度达标；快捷按钮可选方向键切换。

## 阶段 3：技术架构与脚手架（已完成）
- 栈：Vite + React + Tailwind CSS 3 + PostCSS/Autoprefixer；ESLint 采用 Vite 默认配置。
- 样式基线：Tailwind 主题扩展 surface/panel/accent/danger/muted 颜色与 Segoe/Inter 字体；全局深色背景。
- 页面壳：已替换 Vite 默认示例，提供顶部操作区、玩家表头示意、交互要点说明与汇总区占位。
- 目录结构：Vite 默认结构，移除未用的 App.css；Tailwind content 指向 index.html 与 src/**/*。
- 脚本：`npm run dev` / `build` / `preview` / `lint` 可用。

## 阶段 4：核心功能开发（已完成）
- 玩家管理：增删改玩家（2-8 人），同步更新各局列。
- 对局：新增/删除行、复制上一行、自动平衡（末位补齐差值）；单元格整数输入，快速按钮覆盖 -10~10，附加 ±10 步进。
- 校验：每局分值和必须为 0，失衡行高亮提示；可手动或自动平衡。
- 撤销/重做：至多 50 步；清空需确认。
- 实时总分：按玩家汇总并标记领先；界面适配移动端滚动。
- 持久化：localStorage 自动保存 players 与 rounds。

## 阶段 5：数据导出与持久化增强（已完成，导入待补）
- 导出 CSV：含生成时间、玩家表头、每局分值及当局合计、总分行；文件名 `scores-YYYYMMDD-HHMM.csv`；数据使用整数，无浮点误差。
- 本地存储：仍使用 localStorage 存 players 与 rounds；加载失败时回落默认值。
- 导入 CSV：暂未实现，留待后续补充。

## 主要功能
- 玩家管理：可增删玩家，默认提供 3-4 个示例玩家。
- 每局录入：一行即一局，支持快捷键或按钮新增，列包含局号、每个玩家的分值输入、备注（可选）；输入约束为整数，整局分值和自动校验为 0（不平衡时提示并阻止提交/保存）。
- 快速输入：为每个单元格提供快速按钮（-10 至 10）和“+/- 更大”入口；移动端点击友好，支持长按连续加减（可选）。
- 实时计算：输入即刻更新每个玩家的累积总分；显示当前领先/落后提示。
- 数据操作：撤销/重做最近更改；清空全部数据需二次确认。
- 导出：一键导出 CSV（含时间戳、玩家列、各局分值、总分）；导入 CSV（可选，后补）。
- 持久化：本地存储自动保存，刷新不丢数据。

## 交互与布局建议
- 顶部：标题 + 导出按钮 + 清空按钮；（桌面）右侧放撤销/重做。
- 玩家列：横向表头显示玩家名；提供“添加玩家”入口（限制上限，如 8 人）。
- 数据区：表格主体按局号纵向排列；每行末尾有“复制上一行”或“快速填充 0”的快捷操作。
- 汇总区：表格底部或右侧固定展示每位玩家的总分与领先标识；色条或上下箭头提示增减。
- 移动端：表头可水平滚动；新增一局按钮悬浮在右下角；输入框适配触控。

## 状态与校验
- 输入校验：仅允许数字（可为负）；空值默认为 0；错误状态需高亮并提示。
- 操作反馈：导出成功/失败提示；清空前弹出确认；撤销/重做有提示。

## 技术实现提示
- 栈：Vite + React + Tailwind；移动端优先布局。
- 数据结构：`players: string[]`，`rounds: Array<{ id: number; scores: number[]; note?: string }>`，`totals: number[]` 派生计算。
- 整局平衡校验：在提交/切换行时校验 `scores.reduce(...) === 0`，否则标红并阻止新增；可提供“自动平衡”按钮将最后一个玩家补齐差值。
- 快速按钮：为单元格渲染 -10 至 10 的按钮组，外加“+/- 更大”弹出数字键盘；长按可选连续递增。
- 实时汇总：在输入事件中重算 totals；仅整数，无浮点误差。
- 导出 CSV：使用 Blob + `URL.createObjectURL` 生成并触发下载，文件名包含日期时间。
- 本地存储：`localStorage` 存 players 与 rounds；加载时回填表格。
- 可访问性：焦点态、键盘导航、对比度，按钮需 aria-label。

## 开发与运行
- Vite：`npm install` → `npm run dev` → `npm run build` → `npm run preview`。

## 后续待办
- 定稿视觉方案与配色；准备表格、按钮、提示的状态色。
- 设计移动端交互（水平滚动、浮动新增按钮）。
- 补充导入 CSV、玩家排序、局内快捷分配（如平均分摊）。
- 添加单测：汇总计算、导出格式、本地存储读写；加一份手动测试清单。

## 项目计划（按阶段）
- 阶段 1：需求与范围（已完成）
	- 确定玩家数上限、默认玩家、分值范围、移动端适配优先级。
	- 明确每局总和=0 的校验规则、自动平衡策略、撤销/重做需求。
	- 输出：更新后的需求文档。
- 阶段 2：设计方案（已完成）
	- 确定信息架构与布局（表头、数据区、汇总区、浮动新增按钮）。
	- 定义组件规范：输入单元格、快速按钮组（-10~10/可扩展）、警示状态、导出按钮。
	- 输出：低保真线框与交互说明（含移动端）。
- 阶段 3：技术架构与脚手架（已完成）
	- 选型：Vite + React + Tailwind/轻量样式，轻量状态管理。
	- 初始化项目结构，设置 ESLint，建立基础样式变量与主题色。
	- 输出：可运行的空壳项目与基础样式。
- 阶段 4：核心功能开发
	- 玩家管理：增删改玩家、本地存储持久化。
	- 局数据：表格行增删、整数输入、总和=0 校验与错误提示、自动平衡按钮。
	- 快速输入：-10~10 按钮、可扩展更大值、（可选）长按连续加减。
	- 实时汇总：总分栏、领先/落后标识。
	- 撤销/重做、清空确认。
	- 输出：核心交互可用的页面。
- 阶段 5：数据导入导出与持久化
	- CSV 导出（含时间戳、玩家、各局、总分），文件名规范。
	- CSV 导入（可选），本地存储读写恢复。
	- 输出：数据操作闭环。
- 阶段 6：移动端优化与可访问性
	- 断点与滚动策略（表头横向滚动、浮动新增按钮触控优化）。
	- 键盘导航、焦点态、aria 标签，对比度检查。
	- 输出：在手机上流畅可用的版本。
- 阶段 7：测试与验收
	- 单元/集成测试：总分计算、校验、撤销/重做、导出格式、本地存储。
	- 手动测试清单：移动端输入、长按、导出、清空确认。
	- 输出：测试报告与修复列表。
- 阶段 8：优化与发布
	- 体积与性能：懒加载（如需）、字体与图标策略。
	- 文案与细节打磨，版本号与 Changelog。
	- 输出：可发布构建与部署指引。
